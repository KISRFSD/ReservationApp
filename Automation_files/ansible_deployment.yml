---
- hosts: all

  vars:
      db_name: django_app
      db_user: django
      db_password: sdjgh34iutwefhfgbqkj3 

  tasks:
    - name: Installing nginx web server
      sudo: yes
      apt: pkg=nginx,git,python-pip,libpq-dev,python-dev,postgresql,postgresql-contrib,python-psycopg2 state=present

    - name: create directory structure if necessary
      file: path="/home/vagrant/sites/reservation.kisr.me"/{{ item }}
            state=directory
      with_items:
        - static
        - virtualenv
        - source

    - name: Create Database
      sudo: yes
      sudo_user: postgres
      postgresql_db: name={{ db_name }}

    - name: Create User
      sudo: yes
      sudo_user: postgres
      postgresql_user: name={{ db_user }} password={{ db_password }} state=present role_attr_flags=NOSUPERUSER,CREATEDB

    - name: Provide user with DB permissions
      sudo: yes
      sudo_user: postgres
      postgresql_user: user={{ db_user }} db={{ db_name }} priv=ALL

